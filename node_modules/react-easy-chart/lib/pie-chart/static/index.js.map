{"version":3,"sources":["../../../modules/pie-chart/static/index.js"],"names":["color","category20","pie","value","d","sort","getSliceFill","i","data","getLabelText","key","PieChart","array","isRequired","innerHoleSize","number","size","padding","labels","bool","styles","object","mouseOverHandler","func","mouseOutHandler","mouseMoveHandler","clickHandler","props","uid","innerRadius","getInnerRadius","outerRadius","getOuterRadius","arc","radius","node","setAttribute","root","mouseover","mouseout","mousemove","click","path","append","attr","datum","selectAll","enter","getSliceArc","on","getLabelArcTransform","getLabelArc","centroid","labelX","labelY","text","scope","rules","createSvgNode","createSvgRoot","p","calculateChartParameters","createSlices","createLabels","className","createStyle","toReact","Component"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\nimport {\n  scale,\n  layout,\n  svg,\n  select,\n  event as lastEvent\n} from 'd3';\nimport {\n  createUniqueID,\n  defaultStyles\n} from '../../shared';\nimport { createElement } from 'react-faux-dom';\nimport PropTypes from 'prop-types';\nimport { Style } from 'radium';\nimport merge from 'lodash.merge';\n\nconst color = scale.category20();\nconst pie = layout.pie()\n  .value((d) => d.value)\n  .sort(null);\n\nconst getSliceFill = (d, i) => (\n  (d.data.color)\n    ? d.data.color\n    : color(i));\n\nconst getLabelText = (d) => d.data.key;\n\nexport default class PieChart extends React.Component {\n  static get propTypes() {\n    return {\n      data: PropTypes.array.isRequired,\n      innerHoleSize: PropTypes.number,\n      size: PropTypes.number,\n      padding: PropTypes.number,\n      labels: PropTypes.bool,\n      styles: PropTypes.object,\n      mouseOverHandler: PropTypes.func,\n      mouseOutHandler: PropTypes.func,\n      mouseMoveHandler: PropTypes.func,\n      clickHandler: PropTypes.func\n    };\n  }\n\n  static get defaultProps() {\n    return {\n      size: 400,\n      innerHoleSize: 0,\n      padding: 2,\n      labels: false,\n      styles: {},\n      mouseOverHandler: () => {},\n      mouseOutHandler: () => {},\n      mouseMoveHandler: () => {},\n      clickHandler: () => {}\n    };\n  }\n\n  constructor(props) {\n    super(props);\n    this.uid = createUniqueID(props);\n  }\n\n  getSliceArc() {\n    const {\n      padding\n    } = this.props;\n\n    const innerRadius = this.getInnerRadius();\n    const outerRadius = this.getOuterRadius();\n\n    return svg.arc()\n      .innerRadius(innerRadius - padding)\n      .outerRadius(outerRadius - padding);\n  }\n\n  getLabelArc() {\n    const {\n      padding\n    } = this.props;\n\n    const outerRadius = this.getOuterRadius();\n    const radius = outerRadius - padding - ((20 * outerRadius) / 100);\n\n    return svg.arc()\n      .outerRadius(radius)\n      .innerRadius(radius);\n  }\n\n  getOuterRadius() {\n    return this.props.size * 0.5;\n  }\n\n  getInnerRadius() {\n    return this.props.innerHoleSize * 0.5;\n  }\n\n  createSvgNode({ size }) {\n    const node = createElement('svg');\n    node.setAttribute('width', size);\n    node.setAttribute('height', size);\n    return node;\n  }\n\n  createSvgRoot({ node }) {\n    return select(node);\n  }\n\n  createSlices({ root }) {\n    const {\n      data,\n      mouseOverHandler,\n      mouseOutHandler,\n      mouseMoveHandler,\n      clickHandler\n    } = this.props;\n\n    const radius = this.getOuterRadius();\n\n    const mouseover = (d) => mouseOverHandler(d, lastEvent);\n    const mouseout = (d) => mouseOutHandler(d, lastEvent);\n    const mousemove = (d) => mouseMoveHandler(d, lastEvent);\n    const click = (d) => clickHandler(d, lastEvent);\n\n    const path = root\n      .append('g')\n      .attr('transform', `translate(${radius}, ${radius})`)\n      .datum(data)\n      .selectAll('path')\n      .data(pie);\n\n    path\n      .enter()\n      .append('path')\n      .attr('class', 'pie-chart-slice')\n      .attr('fill', getSliceFill)\n      .attr('d', this.getSliceArc())\n      .on('mouseover', mouseover)\n      .on('mouseout', mouseout)\n      .on('mousemove', mousemove)\n      .on('click', click);\n  }\n\n  createLabels({ root }) {\n    const {\n      data\n    } = this.props;\n\n    const radius = this.getOuterRadius();\n\n    const getLabelArcTransform = (d) => {\n      const [labelX, labelY] = this.getLabelArc().centroid(d);\n      return `translate(${labelX}, ${labelY})`;\n    };\n\n    const text = root\n      .append('g')\n      .attr('transform', `translate(${radius}, ${radius})`)\n      .datum(data)\n      .selectAll('text')\n      .data(pie);\n    text\n      .enter()\n      .append('text')\n      .attr('class', 'pie-chart-label')\n      .attr('dy', '.35em')\n      .attr('transform', getLabelArcTransform)\n      .text(getLabelText);\n  }\n\n  createStyle() {\n    const {\n      styles\n    } = this.props;\n\n    const uid = this.uid;\n    const scope = `.pie-chart-${uid}`;\n    const rules = merge({}, defaultStyles, styles);\n\n    return (\n      <Style\n        scopeSelector={scope}\n        rules={rules}\n      />\n    );\n  }\n\n  calculateChartParameters() {\n    const {\n      size\n    } = this.props;\n\n    const node = this.createSvgNode({ size });\n    const root = this.createSvgRoot({ node });\n\n    return {\n      node,\n      root\n    };\n  }\n\n  render() {\n    const {\n      labels\n    } = this.props;\n\n    const p = this.calculateChartParameters();\n\n    this.createSlices(p);\n\n    if (labels) {\n      this.createLabels(p);\n    }\n\n    const uid = this.uid;\n    const className = `pie-chart-${uid}`;\n    const {\n      node\n    } = p;\n\n    return (\n      <div className={className}>\n        {this.createStyle()}\n        {node.toReact()}\n      </div>\n    );\n  }\n}\n"]}